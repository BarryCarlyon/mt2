<div ng-controller="HomeController as homeCtrl" layout="column" layout-align="start stretch" class="wrapper">
  <div class="home-controls" layout="row" flex="none">
    <div class="login-button" flex="none">
      <md-button class="loginWithTwitch md-primary md-raised" ng-click="mainCtrl.loginWithTwitch()" ng-if="!mainCtrl.auth">
        Log in with twitch
      </md-button>
      <md-button class="loginWithTwitch md-primary md-raised" ng-click="mainCtrl.logoutFromTwitch()" ng-if="mainCtrl.auth">
        Log out ({{mainCtrl.auth.name}})
      </md-button>
    </div>
    <div flex="none" layout="row" layout-align="space-between center">
      <!-- <span>Profile:</span>
      <md-select class="compact md-no-underline" ng-model="mainCtrl.selectedProfile" ng-change="mainCtrl.updateConfig()">
        <md-option ng-repeat="(id, profile) in mainCtrl.profiles" ng-value="id">{{profile.name}}</md-option>
      </md-select> -->
      <md-button class="md-primary md-icon-button" ng-click="homeCtrl.openSettings($event)">
        <md-icon>settings</md-icon>
      </md-button>
    </div>
  </div>
  <md-input-container flex="none">
    <input type="text" placeholder="Search..." ng-model="homeCtrl.streamSearchText" ng-change="homeCtrl.getSearchedStreams()">
  </md-input-container>

  <div class="stream-list" layout="row" layout-align="start start" layout-wrap flex="100">
    <div ng-repeat="stream in homeCtrl.getStreams()" class="stream-list-item" flex="none" layout="column" layout-align="start stretch">
      <div class="stream-preview-wrapper">
          <img class="stream-preview" ng-src="{{stream.preview.medium}}">
          <div class="stream-add-buttons" layout="row" layout-align="start start" layout-wrap>
            <div class="stream-add-button chat-adder" ng-repeat="preset in mainCtrl.getSetting('chatPresets')"
              golden-layout-drag-source gl-ds-channel="stream.channel.name" gl-ds-template="'chatTemplate'" gl-ds-layout="mainCtrl.layout" gl-ds-settings-preset="preset.settings">
                <md-tooltip md-delay="500">{{preset.name}}</md-tooltip>
                <md-icon ng-if="preset.icon.type === 'icon'">{{preset.icon.code}}</md-icon>
                <span ng-if="preset.icon.type === 'text'" class="chat-adder-label">{{preset.icon.text}}</span>
                <img ng-if="preset.icon.type === 'image'" class="chat-adder-label" ng-src="{{preset.icon.image}}">
            </div>
            <div class="stream-add-button stream-adder" golden-layout-drag-source gl-ds-channel="stream.channel.name" gl-ds-template="'streamTemplate'"
              gl-ds-layout="mainCtrl.layout">
              <md-icon>videocam</md-icon>
            </div>
          </div>
      </div>
      <div class="stream-title" flex="none">{{stream.channel.status}}</div>
      <div class="stream-meta" flex="none" ng-if="stream.viewers"><strong>{{stream.viewers}}</strong> watching <strong>{{stream.channel.display_name}}</strong> playing <strong>{{stream.game}}</strong></div>
      <div class="stream-meta" flex="none" ng-if="!stream.viewers"><strong>{{stream.channel.display_name}}</strong></div>
      <div class="spacer" flex="100"></div>
    </div>
    <div ng-hide="homeCtrl.getStreams().length">No streams found</div>
  </div>
</div>
